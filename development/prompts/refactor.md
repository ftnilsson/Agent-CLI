# Refactor

Refactor the following code to improve its structure, readability, and maintainability.

## Guidelines

1. **Preserve behaviour** — The refactored code must produce the same outputs for the same inputs. Do not change the public API unless explicitly asked.
2. **Extract functions** — Break large functions into smaller, well-named helpers.
3. **Reduce nesting** — Use early returns, guard clauses, and flat control flow.
4. **Use clear names** — Rename variables and functions to reveal intent.
5. **Remove dead code** — Delete unused variables, imports, and unreachable branches.
6. **Apply patterns** — Where appropriate, use established patterns (strategy, composition, etc.) instead of long switch/if chains.

## Output Format

1. Show the refactored code in full.
2. After the code, list each change you made and why.
3. Note anything you intentionally left unchanged and why.
